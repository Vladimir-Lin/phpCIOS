<?php
//////////////////////////////////////////////////////////////////////////////
// 時段元件
// 與Weekly元件搭配使用
// 時間單位: 每周基準
// 每日: 86400 秒
// 每周: 7 天
// 總計: 7 * 86400 = 604800 秒
//////////////////////////////////////////////////////////////////////////////
namespace CIOS                                                               ;
//////////////////////////////////////////////////////////////////////////////
class TimeSlot                                                               {
//////////////////////////////////////////////////////////////////////////////
public $Start                                                                ; // 開始時間(秒)
public $End                                                                  ; // 結束時間(秒)
public $States                                                               ; // 時段狀態
//////////////////////////////////////////////////////////////////////////////
function __construct ( )                                                     {
  $this -> clear     ( )                                                     ;
}
//////////////////////////////////////////////////////////////////////////////
function __destruct ( )                                                      {
}
//////////////////////////////////////////////////////////////////////////////
public function clear ( )                                                    {
  ////////////////////////////////////////////////////////////////////////////
  $this -> Start  = 0                                                        ;
  $this -> End    = 0                                                        ;
  $this -> States = 0                                                        ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 設定時段長度
// 參數:
//   TOTAL : 該時段的長度(秒)
//////////////////////////////////////////////////////////////////////////////
public function setInterval ( $TOTAL )                                       {
  $this -> End = $this -> Start + $TOTAL                                     ;
}
//////////////////////////////////////////////////////////////////////////////
// 判斷時間是否在時段之內
// 參數:
//   TOTAL : 該時段的長度(秒)
// 返回值:
//   1  : 時段之前
//   0  : 時段之內
//  -1  : 時段之後
//////////////////////////////////////////////////////////////////////////////
public function Between ( $T )                                               {
  ////////////////////////////////////////////////////////////////////////////
  if ( $this -> Start > $T ) return  1                                       ;
  if ( $this -> End   > $T ) return  0                                       ;
  ////////////////////////////////////////////////////////////////////////////
  return -1                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 該時段的「天」值
//////////////////////////////////////////////////////////////////////////////
public function Day (                                                      ) {
  return intval     ( $this -> Start / 86400 , 10                          ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 該時段的「小時」值
//////////////////////////////////////////////////////////////////////////////
public function Hour (                                                     ) {
  $H   = intval      ( $this -> Start % 86400 , 10                         ) ;
  return intval      ( $H             /  3600 , 10                         ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 該時段的「分鐘」值
//////////////////////////////////////////////////////////////////////////////
public function Minute (                                                   ) {
  $M   = intval        ( $this -> Start % 3600 , 10                        ) ;
  return intval        ( $M             /   60 , 10                        ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 該時段的「秒」值
//////////////////////////////////////////////////////////////////////////////
public function Second (                                                   ) {
  return intval        ( $this -> Start % 60 , 10                          ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 時段長度
// 返回值: 秒(End-Start)
//////////////////////////////////////////////////////////////////////////////
public function Interval (                                                 ) {
  return                 ( $this -> End - $this -> Start                   ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 開始的分鐘索引
// 返回值: 分
//////////////////////////////////////////////////////////////////////////////
public function MinuteIndex (                                              ) {
  return intval             ( $this -> Start / 60 , 10                     ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 結束的分鐘索引
// 返回值: 分
//////////////////////////////////////////////////////////////////////////////
public function EndIndex (                                                 ) {
  return intval          ( $this -> End / 60 , 10                          ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 從資料庫所讀取的數據中取得時段數據
//////////////////////////////////////////////////////////////////////////////
public function obtain  ( $rr      )                                         {
  ////////////////////////////////////////////////////////////////////////////
  $this -> Start  = $rr [ "start"  ]                                         ;
  $this -> End    = $rr [ "end"    ]                                         ;
  $this -> States = $rr [ "states" ]                                         ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 將時段數據轉換成JSON
// 返回值: 文字格式的JSON數據
//////////////////////////////////////////////////////////////////////////////
public function toWeekly       (   $EDITABLE = true , $DISABLED = false    ) {
  ////////////////////////////////////////////////////////////////////////////
  $HS          = $this -> Hour (                                           ) ;
  if                           ( $HS < 10                                  ) {
    $VS        = "0{$HS}"                                                    ;
  } else                                                                     {
    $VS        = "{$HS}"                                                     ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HE          = $HS + 1                                                     ;
  if                           ( $HE < 10                                  ) {
    $VK        = "0{$HE}"                                                    ;
  } else                                                                     {
    $VK        = "{$HE}"                                                     ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $LINES       = array                                                       (
    "start"    => "{$VS}:00"                                                 ,
    "end"      => "{$VK}:00"                                                 ,
    "editable" => $EDITABLE                                                  ,
    "disable"  => $DISABLED                                                  ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return json_encode           ( $LINES                                    ) ;
}
//////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
?>
